--1
CREATE TABLE KATEGORI(

    K_ID char(6) NOT NULL,
    K_JENIS varchar(50) NOT NULL,
    PRIMARY KEY (K_ID)
);
CREATE TABLE AKSES (
    AK_ID char(6) NOT NULL,
    AK_JENIS_AKSES VARCHAR(100) NOT NULL,
    PRIMARY KEY (AK_ID)
);

CREATE TABLE CUSTOMER (
    CS_NIK char(16) NOT NULL,
    CS_NAMA VARCHAR(100) NOT NULL,
    CS_EMAIL VARCHAR(100) NOT NULL,
    CS_ALAMAT VARCHAR(100) NOT NULL,
    CS_USIA INTEGER NOT NULL,
    CS_JENIS_KELAMIN CHAR(1) NOT NULL,
    PRIMARY KEY (CS_NIK)
);
CREATE TABLE PEGAWAI (
    PE_NIP CHAR(10) NOT NULL,
    PE_NAMA VARCHAR(100) NOT NULL,
    PE_NO_TELP VARCHAR(13) NOT NULL,
    PE_EMAIL VARCHAR(100) NOT NULL,
    PE_JENIS_KELAMIN CHAR(1) NOT NULL,
    PE_USIA INTEGER NOT NULL,
    AKSES_AK_ID CHAR(6) NOT NULL,
    PRIMARY KEY (PE_NIP),
    FOREIGN KEY (AKSES_AK_ID) REFERENCES AKSES(AK_ID)
 );
 CREATE TABLE FILM (
    F_ID CHAR(6) NOT NULL,
    F_JUDUL VARCHAR(50) NOT NULL,
    F_JUMLAH_PRODUKSI VARCHAR(50) NOT NULL,
    F_STOK INTEGER NOT NULL,
    F_TAHUN_RILIS INTEGER NOT NULL,
    F_DURASI INTEGER NOT NULL,
    KATEGORI_K_ID CHAR(6) NOT NULL,
    PRIMARY KEY (F_ID),
    FOREIGN KEY (KATEGORI_K_ID) REFERENCES KATEGORI(K_ID)
 );
 CREATE TABLE NO_TELP (
    NO_NOMOR_TELEPON VARCHAR(15) NOT NULL,
    CUSTOMER_CS_NIK CHAR(16) NOT NULL,
    PRIMARY KEY (NO_NOMOR_TELEPON),
    FOREIGN KEY (CUSTOMER_CS_NIK) REFERENCES CUSTOMER(CS_NIK)
 );
 CREATE TABLE TRANSAKSI_RENTAL_FILM (
    TRF_ID CHAR(10) NOT NULL,
    TRF_TGL_RENTAL DATE NOT NULL,
    TFR_TGL_KEMBALI DATE NOT NULL,
    TRF_DENDA DECIMAL(10,2),
    PEGAWAI_PE_NIP CHAR(10) NOT NULL,
    CUSTOMER_CS_NIK CHAR(16) NOT NULL,
    PRIMARY KEY (TRF_ID),
    FOREIGN KEY (PEGAWAI_PE_NIP) REFERENCES PEGAWAI(PE_NIP),
    FOREIGN KEY (CUSTOMER_CS_NIK) REFERENCES CUSTOMER(CS_NIK)
 );

 CREATE TABLE RENTAL_FILLM (
    FILM_F_ID CHAR(6) NOT NULL,
    TRANSAKSI_RENTAL_FILM_TRF_ID CHAR(10) NOT NULL,
    FOREIGN KEY (FILM_F_ID) REFERENCES FILM(F_ID),
    FOREIGN KEY (TRANSAKSI_RENTAL_FILM_TRF_ID) REFERENCES TRANSAKSI_RENTAL_FILM(TRF_ID) 
 );

-- 2
CREATE TABLE DIRECTOR (
    ST_ID CHAR(7) NOT NULL,
    ST_NAMA VARCHAR(40) NOT NULL,
    ST_REPUTASI DECIMAL(5,2) NOT NULL,
    PRIMARY KEY (ST_ID)
)

ALTER TABLE FILM
ADD SUTRADARA_ST_ID CHAR(7) NOT NULL ;

ALTER TABLE FILM
ADD CONSTRAINT FOREIGN KEY(SUTRADARA_ST_ID) REFERENCES DIRECTOR(ST_ID);

-- 3 

CREATE TABLE JOB (
    PK_ID INTEGER NOT NULL,
    PK_PEKERJAAN DECIMAL(5,2),
    PRIMARY KEY (PK_ID)
);

ALTER TABLE PEGAWAI
ADD JOB_PK_ID INTEGER NOT NULL ;

ALTER TABLE PEGAWAI
ADD CONSTRAINT FOREIGN KEY(JOB_PK_ID) REFERENCES JOB(PK_ID);

-- 4

DROP TABLE JOB ;

ALTER TABLE PEGAWAI 
ADD PE_JABATAN VARCHAR(40) NOT NULL;


--ALTER TABLE PEGAWAI
--DROP FOREIGN KEY JOB_PK_ID;

--ALTER TABLE PEGAWAI
--DROP COLUMN JOB_PK_ID;


--tambahan :
ALTER TABLE PEGAWAI 
ADD PE_ALAMAT VARCHAR(100) NOT NULL;


-- 5 

INSERT INTO CUSTOMER (CS_NIK,CS_NAMA,CS_EMAIL,CS_ALAMAT,CS_USIA,CS_JENIS_KELAMIN) VALUES ('CUST000000000001','Glenn Tripet','gtripet0@patch.com','46603 Boyd Street','18','F');
INSERT INTO CUSTOMER (CS_NIK,CS_NAMA,CS_EMAIL,CS_ALAMAT,CS_USIA,CS_JENIS_KELAMIN) VALUES ('CUST000000000002','Fawn Senescall','fsenescall1@spiegel.de','132 Anderson WAY','54','F');
INSERT INTO CUSTOMER (CS_NIK,CS_NAMA,CS_EMAIL,CS_ALAMAT,CS_USIA,CS_JENIS_KELAMIN) VALUES ('CUST000000000003','Ab Gladstone','agladstone2@mayoclinic.com','57 Nort Trail','21','M');
INSERT INTO CUSTOMER (CS_NIK,CS_NAMA,CS_EMAIL,CS_ALAMAT,CS_USIA,CS_JENIS_KELAMIN) VALUES ('CUST000000000004','Peadar Dyson','pdyson3@newyorker.com','8 Summerview Circle','33','M');

INSERT INTO NO_TELP (NO_NOMOR_TELEPON,CUSTOMER_CS_NIK) VALUES ('628729155673914','CUST000000000001');
INSERT INTO NO_TELP (NO_NOMOR_TELEPON,CUSTOMER_CS_NIK) VALUES ('628454187815572','CUST000000000002');
INSERT INTO NO_TELP (NO_NOMOR_TELEPON,CUSTOMER_CS_NIK) VALUES ('628803804248717','CUST000000000003');
INSERT INTO NO_TELP (NO_NOMOR_TELEPON,CUSTOMER_CS_NIK) VALUES ('628015403301463','CUST000000000004');

INSERT INTO FILM (F_ID,F_JUDUL,F_JUMLAH_PRODUKSI,F_STOK,F_TAHUN_RILIS,F_DURASI,KATEGORI_K_ID,SUTRADARA_ST_ID) VALUES ('F00001','Gangster','Aksa Bumi Langit','191','1994','147','K00001','ST00001');
INSERT INTO FILM (F_ID,F_JUDUL,F_JUMLAH_PRODUKSI,F_STOK,F_TAHUN_RILIS,F_DURASI,KATEGORI_K_ID,SUTRADARA_ST_ID) VALUES ('F00002','Gantian Dong','Aneka Cahaya Nusantara','52','2012','169','K00002','ST00002');
INSERT INTO FILM (F_ID,F_JUDUL,F_JUMLAH_PRODUKSI,F_STOK,F_TAHUN_RILIS,F_DURASI,KATEGORI_K_ID,SUTRADARA_ST_ID) VALUES ('F00003','Gara Gara','Butik Innovasi Maleo','148','2008','159','K00003','ST00004');
INSERT INTO FILM (F_ID,F_JUDUL,F_JUMLAH_PRODUKSI,F_STOK,F_TAHUN_RILIS,F_DURASI,KATEGORI_K_ID,SUTRADARA_ST_ID) VALUES ('F00004','Gara Gara Bola','Dapurfilm Production','14','1986','114','K00004','ST00003');
INSERT INTO FILM (F_ID,F_JUDUL,F_JUMLAH_PRODUKSI,F_STOK,F_TAHUN_RILIS,F_DURASI,KATEGORI_K_ID,SUTRADARA_ST_ID) VALUES ('F00005','Gara Gara Djanda Muda','Forka Sejahtera Nusantara','156','2002','175','K00005','ST00002');

INSERT INTO KATEGORI (K_ID,K_JENIS) VALUES ('K00001','Romance');
INSERT INTO KATEGORI (K_ID,K_JENIS) VALUES ('K00002','Romcom');
INSERT INTO KATEGORI (K_ID,K_JENIS) VALUES ('K00003','Comedy');
INSERT INTO KATEGORI (K_ID,K_JENIS) VALUES ('K00004','Thriller');
INSERT INTO KATEGORI (K_ID,K_JENIS) VALUES ('K00005','Horor');

INSERT INTO PEGAWAI (PE_NIP,PE_NAMA,PE_NO_TELP,PE_EMAIL,PE_ALAMAT,PE_JENIS_KELAMIN,PE_USIA,PE_JABATAN,AKSES_AK_ID) VALUES ('PE00000001','Jay Jordine','628173677924604','jjordine0@slideshare.net','6158 Internatonal Park','F','39','intern','AK0002');
INSERT INTO PEGAWAI (PE_NIP,PE_NAMA,PE_NO_TELP,PE_EMAIL,PE_ALAMAT,PE_JENIS_KELAMIN,PE_USIA,PE_JABATAN,AKSES_AK_ID) VALUES ('PE00000002','Ange Monkh ouse','628934810980689','amonkhouse1@sohu.com','9 Macpherson Road','F','30','Staff','AK0001');

INSERT INTO AKSES (AK_ID,AK_JENIS_AKSES) VALUES ('AK0001','staff');
INSERT INTO AKSES (AK_ID,AK_JENIS_AKSES) VALUES ('AK0002','intern');
INSERT INTO AKSES (AK_ID,AK_JENIS_AKSES) VALUES ('AK0003','admin');

INSERT INTO TRANSAKSI_RENTAL_FILM (TRF_ID,TRF_TGL_RENTAL,TFR_TGL_KEMBALI,TRF_DENDA,PEGAWAI_PE_NIP,CUSTOMER_CS_NIK) VALUES ('TRF0000001','2023-03-02','2023-03-13','NULL','PE00000001','CUST000000000001');
INSERT INTO TRANSAKSI_RENTAL_FILM (TRF_ID,TRF_TGL_RENTAL,TFR_TGL_KEMBALI,TRF_DENDA,PEGAWAI_PE_NIP,CUSTOMER_CS_NIK) VALUES ('TRF0000002','2023-03-11','2023-03-20','NULL','PE00000002','CUST000000000002');
INSERT INTO TRANSAKSI_RENTAL_FILM (TRF_ID,TRF_TGL_RENTAL,TFR_TGL_KEMBALI,TRF_DENDA,PEGAWAI_PE_NIP,CUSTOMER_CS_NIK) VALUES ('TRF0000003','2023-04-01','2023-04-28','70000.00','PE00000001','CUST000000000003');
INSERT INTO TRANSAKSI_RENTAL_FILM (TRF_ID,TRF_TGL_RENTAL,TFR_TGL_KEMBALI,TRF_DENDA,PEGAWAI_PE_NIP,CUSTOMER_CS_NIK) VALUES ('TRF0000004','2023-04-29','2023-05-05','10000.00','PE00000001','CUST000000000004');

INSERT INTO RENTAL_FILLM (FILM_F_ID,TRANSAKSI_RENTAL_FILM_TRF_ID) VALUES ('F00001','TRF0000001');
INSERT INTO RENTAL_FILLM (FILM_F_ID,TRANSAKSI_RENTAL_FILM_TRF_ID) VALUES ('F00003','TRF0000001');
INSERT INTO RENTAL_FILLM (FILM_F_ID,TRANSAKSI_RENTAL_FILM_TRF_ID) VALUES ('F00001','TRF0000002');
INSERT INTO RENTAL_FILLM (FILM_F_ID,TRANSAKSI_RENTAL_FILM_TRF_ID) VALUES ('F00004','TRF0000003');
INSERT INTO RENTAL_FILLM (FILM_F_ID,TRANSAKSI_RENTAL_FILM_TRF_ID) VALUES ('F00005','TRF0000004');

INSERT INTO DIRECTOR (ST_ID,ST_NAMA,ST_REPUTASI) VALUES ('ST00001','Marga Eggerton','96.06');
INSERT INTO DIRECTOR (ST_ID,ST_NAMA,ST_REPUTASI) VALUES ('ST00002','Demetria Genese','84.66');
INSERT INTO DIRECTOR (ST_ID,ST_NAMA,ST_REPUTASI) VALUES ('ST00003','Cory Greenroa','10.59');
INSERT INTO DIRECTOR (ST_ID,ST_NAMA,ST_REPUTASI) VALUES ('ST00004','Deveen Freestone','42.32');

-- SHOW KEYS FROM FILM WHERE Key_name = 'KATEGORI_K_ID';
--  SHOW CREATE TABLE FILM;


-- 6

ALTER TABLE FILM
DROP FOREIGN KEY KATEGORI_K_ID;

ALTER TABLE KATEGORI
MODIFY COLUMN K_ID INT AUTO_INCREMENT;



-- 7 

INSERT INTO PEGAWAI (PE_NIP,PE_NAMA,PE_NO_TELP,PE_EMAIL,PE_ALAMAT,PE_JENIS_KELAMIN,PE_USIA,PE_JABATAN,AKSES_AK_ID) VALUES ('PE00000003','Valerie Gala','628173677924604','valgala@gmail.com','202 Getaway Street','F','19','staff','AK0001');

UPDATE TRANSAKSI_RENTAL_FILM
SET PEGAWAI_PE_NIP = 'PE00000003'
WHERE TRF_ID = 'TRF0000004';

--8

UPDATE DIRECTOR
SET ST_REPUTASI = ROUND(ST_REPUTASI);

--9

UPDATE TRANSAKSI_RENTAL_FILM
SET TRF_DENDA = NULL
WHERE CUSTOMER_CS_NIK = 'CUST000000000003';

UPDATE TRANSAKSI_RENTAL_FILM
SET TRF_DENDA = NULL
WHERE CUSTOMER_CS_NIK = 'CUST000000000004';

--10

DELETE FROM RENTAL_FILLM
WHERE FILM_F_ID IN (SELECT FILM_F_ID FROM film WHERE  F_TAHUN_RILIS < 1990);

DELETE FROM FILM
WHERE F_TAHUN_RILIS < 1990;

--11

INSERT INTO TRANSAKSI_RENTAL_FILM (TRF_ID,TRF_TGL_RENTAL,TFR_TGL_KEMBALI,TRF_DENDA,PEGAWAI_PE_NIP,CUSTOMER_CS_NIK) VALUES ('TRF0000005','2023-09-13','2023-12-20','40000.00','PE00000001','CUST000000000001');

UPDATE FILM
SET F_STOK = F_STOK - 2
WHERE F_JUDUL IN ('Gara Gara');

UPDATE TRANSAKSI_RENTAL_FILM 
SET TFR_TGL_KEMBALI = '2023-09-13'
WHERE TFR_TGL_KEMBALI = '2023-12-20';

UPDATE FILM 
SET F_STOK = F_STOK + 2
WHERE F_JUDUL IN ('Gara Gara');

UPDATE TRANSAKSI_RENTAL_FILM
SET 
TFR_TGL_KEMBALI = '2023-12-20'
WHERE 
TFR_TGL_KEMBALI = '2023-09-13' ;

UPDATE FILM
SET F_STOK = F_STOK - 2
WHERE F_JUDUL IN ('Gantian Dong');